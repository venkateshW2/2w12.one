<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Downloader - 2W12.ONE</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-color: #fafafa;
            --text-primary: #1a1a1a;
            --text-secondary: #666;
            --text-muted: #999;
            --border-color: #e1e1e1;
            --accent-color: #777777;
            --hover-bg: #f5f5f5;
            --card-bg: #eeeeee;
            --success-color: #4ade80;
            --error-color: #ff6b6b;
            --warning-color: #fbbf24;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
            font-weight: 300;
            letter-spacing: -0.01em;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(250, 250, 250, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(225, 225, 225, 0.3);
            padding: 15px 20px;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nav-links {
            display: flex;
            gap: 20px;
            background: rgba(255, 255, 255, 0.8);
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid var(--border-color);
        }

        .nav-link {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--text-secondary);
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: color 0.3s ease;
        }

        .nav-link:hover {
            color: var(--text-primary);
        }

        .tool-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            color: var(--text-primary);
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .status-indicator {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: var(--text-muted);
            letter-spacing: 1px;
        }

        .status-dot {
            display: inline-block;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: var(--success-color);
            margin-right: 8px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        /* Main Container */
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 80px 20px 40px;
            min-height: 100vh;
        }

        /* URL Input Section */
        .input-section {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 30px;
            margin-bottom: 30px;
        }

        .input-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
        }

        .url-input-group {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .url-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            background: white;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .url-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 3px rgba(119, 119, 119, 0.1);
        }

        .url-input::placeholder {
            color: var(--text-muted);
        }

        .fetch-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .fetch-btn:hover {
            background: var(--text-primary);
            transform: translateY(-1px);
        }

        .fetch-btn:disabled {
            background: var(--text-muted);
            cursor: not-allowed;
            transform: none;
        }

        .url-examples {
            font-family: 'JetBrains Mono', monospace;
            font-size: 9px;
            color: var(--text-muted);
            line-height: 1.4;
        }

        .url-examples strong {
            color: var(--text-secondary);
        }

        /* Video Info Section */
        .video-info {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 30px;
            margin-bottom: 30px;
            display: none;
        }

        .video-info.show {
            display: block;
            animation: fadeInUp 0.4s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .video-header {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
        }

        .video-thumbnail {
            width: 160px;
            height: 90px;
            border-radius: 4px;
            overflow: hidden;
            flex-shrink: 0;
            border: 1px solid var(--border-color);
        }

        .video-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .video-details {
            flex: 1;
        }

        .video-title {
            font-size: 16px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .video-meta {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: var(--text-muted);
            line-height: 1.6;
        }

        .video-meta-item {
            margin-bottom: 4px;
        }

        .video-meta strong {
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Download Options */
        .download-section {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 30px;
            margin-bottom: 30px;
            display: none;
        }

        .download-section.show {
            display: block;
            animation: fadeInUp 0.4s ease 0.2s both;
        }

        .download-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
        }

        .format-tabs {
            display: flex;
            gap: 2px;
            background: var(--border-color);
            border-radius: 6px;
            padding: 4px;
            margin-bottom: 20px;
        }

        .format-tab {
            flex: 1;
            padding: 10px 16px;
            background: transparent;
            border: none;
            border-radius: 4px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .format-tab:hover {
            background: rgba(255, 255, 255, 0.7);
            color: var(--text-primary);
        }

        .format-tab.active {
            background: var(--accent-color);
            color: white;
        }

        .download-options {
            display: none;
        }

        .download-options.active {
            display: block;
        }

        .download-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .download-option {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .download-option:hover {
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .option-format {
            font-family: 'JetBrains Mono', monospace;
            font-size: 12px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 4px;
            text-transform: uppercase;
        }

        .option-quality {
            font-size: 11px;
            color: var(--text-secondary);
            margin-bottom: 8px;
        }

        .option-size {
            font-family: 'JetBrains Mono', monospace;
            font-size: 9px;
            color: var(--text-muted);
        }

        .download-btn {
            position: absolute;
            top: 12px;
            right: 12px;
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 3px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.3s ease;
            opacity: 0;
        }

        .download-option:hover .download-btn {
            opacity: 1;
        }

        .download-btn:hover {
            background: var(--text-primary);
        }

        /* Progress Section */
        .progress-section {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 30px;
            margin-bottom: 30px;
            display: none;
        }

        .progress-section.show {
            display: block;
            animation: fadeInUp 0.4s ease;
        }

        .progress-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
        }

        .progress-item {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .progress-filename {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: var(--text-primary);
        }

        .progress-status {
            font-family: 'JetBrains Mono', monospace;
            font-size: 9px;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .progress-bar {
            width: 100%;
            height: 4px;
            background: var(--border-color);
            border-radius: 2px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--success-color);
            border-radius: 2px;
            transition: width 0.3s ease;
            width: 0%;
        }

        /* Download History */
        .history-section {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 30px;
        }

        .history-title {
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .clear-history {
            background: none;
            border: none;
            color: var(--accent-color);
            font-family: 'JetBrains Mono', monospace;
            font-size: 9px;
            text-transform: uppercase;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 3px;
            transition: all 0.3s ease;
        }

        .clear-history:hover {
            background: var(--accent-color);
            color: white;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .history-item {
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            padding: 12px;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-info {
            flex: 1;
        }

        .history-filename {
            font-family: 'JetBrains Mono', monospace;
            font-size: 10px;
            color: var(--text-primary);
            margin-bottom: 2px;
        }

        .history-time {
            font-family: 'JetBrains Mono', monospace;
            font-size: 8px;
            color: var(--text-muted);
        }

        .redownload-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 8px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .redownload-btn:hover {
            background: var(--text-primary);
        }

        /* Error Messages */
        .error-message {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            border-radius: 4px;
            padding: 15px;
            margin-top: 15px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 11px;
            color: #d73527;
            text-align: center;
            display: none;
        }

        .error-message.show {
            display: block;
            animation: fadeInUp 0.3s ease;
        }

        /* Loading States */
        .loading {
            display: inline-block;
            width: 12px;
            height: 12px;
            border: 2px solid var(--border-color);
            border-radius: 50%;
            border-top-color: var(--accent-color);
            animation: spin 1s ease-in-out infinite;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 100px 15px 40px;
            }

            .url-input-group {
                flex-direction: column;
            }

            .video-header {
                flex-direction: column;
                text-align: center;
            }

            .video-thumbnail {
                align-self: center;
            }

            .download-grid {
                grid-template-columns: 1fr;
            }

            .format-tabs {
                flex-direction: column;
            }

            .nav-links {
                position: fixed;
                top: 60px;
                left: 15px;
                right: 15px;
                justify-content: center;
                background: rgba(250, 250, 250, 0.95);
                backdrop-filter: blur(10px);
                z-index: 999;
                padding: 10px;
            }

            .header {
                padding: 10px 15px;
            }

            .tool-title {
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="nav-links">
            <a href="../../" class="nav-link">‚Üê Tools</a>
            <a href="../../portfolio/" class="nav-link">Portfolio</a>
        </div>
        <div class="tool-title">YouTube Downloader</div>
        <div class="status-indicator">
            <span class="status-dot"></span>
            <span>READY</span>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- URL Input Section -->
        <div class="input-section">
            <div class="input-title">Enter YouTube URL (Videos & Shorts)</div>
            <div class="url-input-group">
                <input 
                    type="text" 
                    class="url-input" 
                    id="urlInput"
                    placeholder="https://www.youtube.com/watch?v=..."
                >
                <button class="fetch-btn" id="fetchBtn">
                    <span class="btn-text">Fetch</span>
                </button>
            </div>
            <div class="url-examples">
                <strong>Supported formats:</strong> youtube.com/watch?v=..., youtu.be/..., youtube.com/shorts/..., m.youtube.com/...
            </div>
            <div class="error-message" id="errorMessage"></div>
        </div>

        <!-- Video Info Section -->
        <div class="video-info" id="videoInfo">
            <div class="video-header">
                <div class="video-thumbnail">
                    <img id="videoThumbnail" src="" alt="Video thumbnail">
                </div>
                <div class="video-details">
                    <div class="video-title" id="videoTitle">Video Title</div>
                    <div class="video-meta">
                        <div class="video-meta-item">
                            <strong>Duration:</strong> <span id="videoDuration">--</span>
                        </div>
                        <div class="video-meta-item">
                            <strong>Channel:</strong> <span id="videoChannel">--</span>
                        </div>
                        <div class="video-meta-item">
                            <strong>Views:</strong> <span id="videoViews">--</span>
                        </div>
                        <div class="video-meta-item">
                            <strong>Upload:</strong> <span id="videoUpload">--</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Download Options Section -->
        <div class="download-section" id="downloadSection">
            <div class="download-title">Download Options</div>
            
            <div class="format-tabs">
                <button class="format-tab active" data-format="video">Video (MP4)</button>
                <button class="format-tab" data-format="audio">Audio (MP3)</button>
                <button class="format-tab" data-format="other">Other Formats</button>
            </div>

            <!-- Video Options -->
            <div class="download-options active" id="video-options">
                <div class="download-grid" id="videoGrid">
                    <!-- Video options will be populated here -->
                </div>
            </div>

            <!-- Audio Options -->
            <div class="download-options" id="audio-options">
                <div class="download-grid" id="audioGrid">
                    <!-- Audio options will be populated here -->
                </div>
            </div>

            <!-- Other Format Options -->
            <div class="download-options" id="other-options">
                <div class="download-grid" id="otherGrid">
                    <!-- Other format options will be populated here -->
                </div>
            </div>
        </div>

        <!-- Progress Section -->
        <div class="progress-section" id="progressSection">
            <div class="progress-title">Download Progress</div>
            <div id="progressList">
                <!-- Progress items will be added here -->
            </div>
        </div>

        <!-- Download History -->
        <div class="history-section">
            <div class="history-title">
                Download History
                <button class="clear-history" onclick="clearHistory()">Clear All</button>
            </div>
            <div class="history-list" id="historyList">
                <div style="text-align: center; color: var(--text-muted); font-size: 12px; padding: 20px;">
                    No downloads yet
                </div>
            </div>
        </div>
    </div>

    <script>
        class YouTubeDownloader {
            constructor() {
                this.currentVideo = null;
                this.downloadHistory = this.loadHistory();
                this.setupEventListeners();
                this.renderHistory();
            }

            // Safe localStorage handling
            loadHistory() {
                try {
                    return JSON.parse(localStorage.getItem('downloadHistory') || '[]');
                } catch (error) {
                    console.warn('localStorage not available, using in-memory storage');
                    return [];
                }
            }

            saveHistory() {
                try {
                    localStorage.setItem('downloadHistory', JSON.stringify(this.downloadHistory));
                } catch (error) {
                    console.warn('Could not save to localStorage');
                }
            }

            setupEventListeners() {
                // URL input and fetch button
                const urlInput = document.getElementById('urlInput');
                const fetchBtn = document.getElementById('fetchBtn');

                fetchBtn.addEventListener('click', () => this.fetchVideoInfo());
                urlInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.fetchVideoInfo();
                });

                // Format tabs
                document.querySelectorAll('.format-tab').forEach(tab => {
                    tab.addEventListener('click', () => this.switchFormat(tab.dataset.format));
                });
            }

            async fetchVideoInfo() {
                const url = document.getElementById('urlInput').value.trim();
                const fetchBtn = document.getElementById('fetchBtn');
                const errorMessage = document.getElementById('errorMessage');

                // Validate URL
                if (!this.isValidYouTubeUrl(url)) {
                    this.showError('Please enter a valid YouTube URL');
                    return;
                }

                // Show loading state
                fetchBtn.innerHTML = '<div class="loading"></div><span>Fetching...</span>';
                fetchBtn.disabled = true;
                errorMessage.classList.remove('show');

                try {
                    // Simulate API call (replace with actual API)
                    const videoData = await this.fetchVideoDataFromAPI(url);                    
                    this.currentVideo = videoData;
                    this.displayVideoInfo(videoData);
                    this.generateDownloadOptions(videoData);
                    console.log('Making API request to:', requestUrl);

                } catch (error) {
                    this.showError('Failed to fetch video information. Please try again.');
                } finally {
                    fetchBtn.innerHTML = '<span class="btn-text">Fetch</span>';
                    fetchBtn.disabled = false;
                }
            }

            isValidYouTubeUrl(url) {
                const patterns = [
                    /^https?:\/\/(www\.)?youtube\.com\/watch\?v=[\w-]+/,
                    /^https?:\/\/youtu\.be\/[\w-]+/,
                    /^https?:\/\/m\.youtube\.com\/watch\?v=[\w-]+/,
                    /^https?:\/\/(www\.)?youtube\.com\/shorts\/[\w-]+/,  // YouTube Shorts
                    /^https?:\/\/youtube\.com\/shorts\/[\w-]+/
                ];
                return patterns.some(pattern => pattern.test(url));
            }

         async fetchVideoDataFromAPI(url) {
            const videoId = this.extractVideoId(url);
            if (!videoId) {
                throw new Error('Could not extract video ID from URL');
            }

            const apiUrl = `https://ytstream-download-youtube-videos.p.rapidapi.com/Download/Stream`;
            const options = {
                method: 'GET',
                headers: {
                    'X-RapidAPI-Key': '0950947a59msh129f99a31d7db49p103ec3jsn41d98dab874b',
                    'X-RapidAPI-Host': 'ytstream-download-youtube-videos.p.rapidapi.com'
                }
                };

                const requestUrl = `${apiUrl}?id=${videoId}`;
                const response = await fetch(requestUrl, options);
                
                if (!response.ok) {
                    if (response.status === 429) {
                        throw new Error('Rate limit exceeded. Please try again later.');
                    } else if (response.status === 403) {
                        throw new Error('API access denied. Please check your subscription.');
                    } else {
                        throw new Error(`API request failed: ${response.status}`);
                    }
                }

                const data = await response.json();
                return this.parseAPIResponse(data, videoId);
            }
            extractVideoId(url) {
    // Clean the URL first
    url = url.trim();
    
    const patterns = [
        /(?:youtube\.com\/watch\?v=)([a-zA-Z0-9_-]{11})/,
        /(?:youtu\.be\/)([a-zA-Z0-9_-]{11})/,
        /(?:youtube\.com\/shorts\/)([a-zA-Z0-9_-]{11})/,
        /(?:youtube\.com\/embed\/)([a-zA-Z0-9_-]{11})/
    ];
    
    for (const pattern of patterns) {
        const match = url.match(pattern);
        if (match && match[1].length === 11) {
            console.log('Extracted video ID:', match[1]);
            return match[1];
        }
    }
    console.error('Could not extract video ID from:', url);
    return null;
}

            parseAPIResponse(data, videoId) {
                const videoInfo = {
                    id: videoId,
                    title: data.title || 'Unknown Title',
                    thumbnail: `https://img.youtube.com/vi/${videoId}/maxresdefault.jpg`,
                    duration: this.formatDuration(data.lengthSeconds || 0),
                    channel: data.author || 'Unknown Channel',
                    views: data.viewCount ? this.formatViews(data.viewCount) : 'Unknown',
                    uploadDate: data.publishDate || 'Unknown',
                    formats: {
                        video: [
                            { quality: '1080p', format: 'MP4', size: '45.2 MB', url: '#' },
                            { quality: '720p', format: 'MP4', size: '28.1 MB', url: '#' },
                            { quality: '480p', format: 'MP4', size: '16.7 MB', url: '#' },
                            { quality: '360p', format: 'MP4', size: '12.3 MB', url: '#' }
                        ],
                        audio: [
                            { quality: '320 kbps', format: 'MP3', size: '8.1 MB', url: '#' },
                            { quality: '256 kbps', format: 'MP3', size: '6.4 MB', url: '#' },
                            { quality: '128 kbps', format: 'MP3', size: '3.2 MB', url: '#' },
                            { quality: 'Lossless', format: 'WAV', size: '35.2 MB', url: '#' }
                        ],
                        other: [
                            { quality: '1080p', format: 'WebM', size: '42.1 MB', url: '#' },
                            { quality: '720p', format: 'WebM', size: '26.3 MB', url: '#' },
                            { quality: 'Audio', format: 'OGG', size: '7.2 MB', url: '#' },
                            { quality: 'Audio', format: 'M4A', size: '7.8 MB', url: '#' }
                        ]
                    }
                };
                return videoInfo;
            }

            formatDuration(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            }

            formatViews(viewCount) {
                const num = parseInt(viewCount);
                if (num >= 1000000000) {
                    return (num / 1000000000).toFixed(1) + 'B views';
                } else if (num >= 1000000) {
                    return (num / 1000000).toFixed(1) + 'M views';
                } else if (num >= 1000) {
                    return (num / 1000).toFixed(1) + 'K views';
                } else {
                    return num + ' views';
                }
            }
            displayVideoInfo(videoData) {
                document.getElementById('videoThumbnail').src = videoData.thumbnail;
                document.getElementById('videoTitle').textContent = videoData.title;
                document.getElementById('videoDuration').textContent = videoData.duration;
                document.getElementById('videoChannel').textContent = videoData.channel;
                document.getElementById('videoViews').textContent = videoData.views;
                document.getElementById('videoUpload').textContent = videoData.uploadDate;

                document.getElementById('videoInfo').classList.add('show');
                document.getElementById('downloadSection').classList.add('show');
            }

            generateDownloadOptions(videoData) {
                this.populateFormatGrid('video', videoData.formats.video);
                this.populateFormatGrid('audio', videoData.formats.audio);
                this.populateFormatGrid('other', videoData.formats.other);
            }

            populateFormatGrid(type, formats) {
                const grid = document.getElementById(`${type}Grid`);
                grid.innerHTML = '';

                formats.forEach(format => {
                    const option = document.createElement('div');
                    option.className = 'download-option';
                    option.innerHTML = `
                        <div class="option-format">${format.format}</div>
                        <div class="option-quality">${format.quality}</div>
                        <div class="option-size">${format.size}</div>
                        <button class="download-btn" onclick="youtubeDownloader.downloadFile('${format.format}', '${format.quality}', '${format.url}')">
                            Download
                        </button>
                    `;
                    grid.appendChild(option);
                });
            }

            switchFormat(format) {
                // Update active tab
                document.querySelectorAll('.format-tab').forEach(tab => {
                    tab.classList.toggle('active', tab.dataset.format === format);
                });

                // Show corresponding options
                document.querySelectorAll('.download-options').forEach(options => {
                    options.classList.toggle('active', options.id === `${format}-options`);
                });
            }

            async downloadFile(format, quality, url) {
                const filename = `${this.currentVideo.title.replace(/[^a-z0-9]/gi, '_')}_${quality}.${format.toLowerCase()}`;
                
                // Add to progress
                this.addToProgress(filename);
                
                try {
                    // Simulate download process
                    await this.simulateDownload(filename);
                    
                    // Add to history
                    this.addToHistory(filename, format, quality);
                    
                    // In real implementation, trigger actual download
                    // window.open(url, '_blank');
                    
                } catch (error) {
                    this.showError('Download failed. Please try again.');
                }
            }

            addToProgress(filename) {
                const progressSection = document.getElementById('progressSection');
                const progressList = document.getElementById('progressList');
                
                const progressItem = document.createElement('div');
                progressItem.className = 'progress-item';
                progressItem.id = `progress-${Date.now()}`;
                progressItem.innerHTML = `
                    <div class="progress-header">
                        <div class="progress-filename">${filename}</div>
                        <div class="progress-status">Preparing...</div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill"></div>
                    </div>
                `;
                
                progressList.appendChild(progressItem);
                progressSection.classList.add('show');
                
                return progressItem;
            }

            async simulateDownload(filename) {
                const progressItem = document.querySelector(`#progressList .progress-item:last-child`);
                const progressFill = progressItem.querySelector('.progress-fill');
                const progressStatus = progressItem.querySelector('.progress-status');
                
                // Simulate download progress
                for (let i = 0; i <= 100; i += 10) {
                    await new Promise(resolve => setTimeout(resolve, 200));
                    progressFill.style.width = `${i}%`;
                    
                    if (i < 100) {
                        progressStatus.textContent = `Downloading... ${i}%`;
                    } else {
                        progressStatus.textContent = 'Complete';
                        progressStatus.style.color = 'var(--success-color)';
                    }
                }
                
                // Auto-remove completed item after 3 seconds
                setTimeout(() => {
                    progressItem.remove();
                    if (document.getElementById('progressList').children.length === 0) {
                        document.getElementById('progressSection').classList.remove('show');
                    }
                }, 3000);
            }

            addToHistory(filename, format, quality) {
                const historyItem = {
                    filename,
                    format,
                    quality,
                    timestamp: new Date().toISOString(),
                    video: this.currentVideo
                };
                
                this.downloadHistory.unshift(historyItem);
                
                // Keep only last 10 downloads
                if (this.downloadHistory.length > 10) {
                    this.downloadHistory = this.downloadHistory.slice(0, 10);
                }
                
                this.saveHistory();
                this.renderHistory();
            }

            renderHistory() {
                const historyList = document.getElementById('historyList');
                
                if (this.downloadHistory.length === 0) {
                    historyList.innerHTML = `
                        <div style="text-align: center; color: var(--text-muted); font-size: 12px; padding: 20px;">
                            No downloads yet
                        </div>
                    `;
                    return;
                }
                
                historyList.innerHTML = this.downloadHistory.map(item => `
                    <div class="history-item">
                        <div class="history-info">
                            <div class="history-filename">${item.filename}</div>
                            <div class="history-time">${new Date(item.timestamp).toLocaleString()}</div>
                        </div>
                        <button class="redownload-btn" onclick="youtubeDownloader.redownload('${item.video.id}')">
                            Redownload
                        </button>
                    </div>
                `).join('');
            }

            redownload(videoId) {
                // Find video in history and re-trigger download process
                const historyItem = this.downloadHistory.find(item => item.video.id === videoId);
                if (historyItem) {
                    document.getElementById('urlInput').value = `https://youtube.com/watch?v=${videoId}`;
                    this.fetchVideoInfo();
                }
            }

            showError(message) {
                const errorMessage = document.getElementById('errorMessage');
                errorMessage.textContent = message;
                errorMessage.classList.add('show');
                
                setTimeout(() => {
                    errorMessage.classList.remove('show');
                }, 5000);
            }
        }

        // Global functions
        function clearHistory() {
            try {
                localStorage.removeItem('downloadHistory');
            } catch (error) {
                console.warn('Could not clear localStorage');
            }
            youtubeDownloader.downloadHistory = [];
            youtubeDownloader.renderHistory();
        }

        // Initialize the downloader
        const youtubeDownloader = new YouTubeDownloader();
    </script>
</body>
</html>